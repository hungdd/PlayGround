<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
		<title>PlayGround</title>
		<link rel="stylesheet"  href="assets/css/jquery.mobile-1.3.1.min.css">
		<link rel="stylesheet"  href="assets/css/jquery.mobile.structure-1.3.1.min.css">
		<link rel="stylesheet"  href="assets/css/jquery.mobile.theme-1.3.1.min.css">
		<link rel="stylesheet"  href="assets/css/playground.css">
		
		<script src="assets/js/jquery-2.0.1.min.js"></script>
		<script src="assets/js/cordova.ios.js"></script>
		<script src="assets/js/jsonrpc.js"></script>
		<script src="assets/js/playground.js"></script>
		<script src="assets/js/jquery.mobile-1.3.1.min.js"></script>
	</head>
	<body>
		<div data-role="page" id="eventlistpage">
			<div data-role="header" data-position="fixed" data-theme="b">
			<!-- <a href="filter.html" data-role="button" data-icon="bars" class="ui-icon-nodisc" data-theme="a" data-iconshadow="false" data-iconpos="notext" data-inline="true" id="togglefilterbtn" data-transition="flip"></a> -->
				<h1>Sự Kiện</h1>
				<a href="#" data-role="button" data-icon="search" class="ui-icon-nodisc ui-btn-right" data-theme="a" data-iconshadow="false" data-iconpos="notext" data-inline="true" id="toggleeventsearchbtn"></a>
			</div><!-- /header -->
	
			<div data-role="content">
				<ul data-role="listview" id="eventsearchsection" class="hide" data-theme="e">
					<li data-role="fieldcontain">
						<input type="search" name="event-search-term" id="event-search-term" value="" placeholder="Tìm kiếm...">
						<div class="button-wrapper" data-role="controlgroup" data-type="horizontal" data-mini="true">
							<a href="#" data-role="button" data-icon="search" id="search-submit" data-theme="b">Tìm</a>
							<a href="#" data-role="button" data-icon="delete" id="search-cancel" data-theme="a" data-iconpos="right">Đóng</a>
						</div>
					</li>
				</ul>
				
				<ul data-role="listview" id="eventlist">
				</ul>
			</div><!-- /content -->
	
			<div data-role="footer" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li><a href="eventlist.html" data-transition="flip" id="eventpagelink" class="ui-btn-active ui-state-persist">Sự Kiện</a></li>
						<li><a href="clublist.html" data-transition="flip" id="clubpagelink">Bars/Clubs</a></li>
						<li><a href="restaurantlist.html" data-transition="flip" id="restaurantpagelink">Nhà hàng</a></li>
						<li><a href="shoppinglist.html" data-transition="flip" id="shoppingpagelink">Mua sắm</a></li>
					</ul>
				</div><!-- /navbar -->
			</div><!-- /footer -->
			<script type="text/javascript">
				function downloadEventList(){
					showLoading();
					wpJSON.request(
					   'pg.getEventList',
					   {},
					   function (result) {
							eventList = result;
							$('ul#eventlist').empty();
							eventList.forEach(function(post){
								$('ul#eventlist').append(
									'<li>' +
										'<a href="eventdetail.html?post_id=' + post.id + '">' + 
											'<img src="' + post.thumbnail[0] + '"/>' +
											'<h2>' + post.name + '</h2>' +
											'<p><strong>' + post.venue.name + '</strong> - ' + post.venue.address + '</p>' +
											'<p class="ui-li-aside"><strong>' + post.date + '</strong><br/><br/>' + post.time + '</p>' +
										'</a>' +
									'</li>'
								);
							});
							$('ul#eventlist').listview('refresh');
							hideLoading();
					   },
					   function( code, error, data ) {
							console.log('error: ' + error);
					   }
					);
				}
				
				$('div#eventlistpage').on('pageshow',function(){
					$('a#clubpagelink,a#restaurantpagelink,a#shoppingpagelink').removeClass('ui-btn-active').removeClass('ui-state-persist');
					
					$('#toggleeventsearchbtn').click(function(){
						$('ul#eventsearchsection').slideDown();
					});

					$('a#search-cancel').click(function(){
						$('ul#eventsearchsection').slideUp();
					});

					$('a#search-submit').click(function(){
						var searchTerm = $('input#event-search-term').val().replace(/\s/g,'+');
						$(this).attr('href','search.html?type=event&s=' + searchTerm);
					});
					
					if (eventList.length == 0){
						downloadEventList();
					} else {
						$('ul#eventlist').empty();
						eventList.forEach(function(post){
							$('ul#eventlist').append(
								'<li>' +
									'<a href="eventdetail.html?post_id=' + post.id + '">' + 
										'<img src="' + post.thumbnail[0] + '"/>' +
										'<h2>' + post.name + '</h2>' +
										'<p><strong>' + post.venue.name + '</strong> - ' + post.venue.address + '</p>' +
										'<p class="ui-li-aside"><strong>' + post.date + '</strong><br/><br/>' + post.time + '</p>' +
									'</a>' +
								'</li>'
							);
						});
						$('ul#eventlist').listview('refresh');
					}
				});
				
				$('a#eventlistrefreshbtn').click(function(){
					eventList = [];
					downloadEventList();
				});
			</script>
		</div><!-- /page#eventlist -->
	</body>
</html>