<div data-role="page" id="restaurantlistpage">
	<div data-role="header" data-position="fixed" data-theme="b">
		<a href="filter.html" data-role="button" data-icon="bars" class="ui-icon-nodisc" data-theme="a" data-iconshadow="false" data-iconpos="notext" data-inline="true" id="togglefilterbtn" data-transition="flip"></a>
		<h1>Nhà hàng</h1>
		<a href="#" data-role="button" data-icon="search" class="ui-icon-nodisc ui-btn-right" data-theme="a" data-iconshadow="false" data-iconpos="notext" data-inline="true" id="togglesearchbtn"></a>
	</div><!-- /header -->

	<div data-role="content">
		<ul data-role="listview" id="searchsection" class="hide" data-theme="e">
			<li data-role="fieldcontain">
				<input type="search" name="search-term" id="search-term" value="" placeholder="Tìm kiếm...">
				<div class="button-wrapper" data-role="controlgroup" data-type="horizontal" data-mini="true">
					<a href="#" data-role="button" data-icon="search" id="search-submit" data-theme="b">Tìm</a>
					<a href="#" data-role="button" data-icon="delete" id="search-cancel" data-theme="a" data-iconpos="right">Đóng</a>
				</div>
			</li>
		</ul>
		
		<ul data-role="listview" id="restaurantlist">
		</ul>
	</div><!-- /content -->

	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="eventlist.html" data-transition="flip" id="eventpagelink">Sự Kiện</a></li>
				<li><a href="clublist.html" data-transition="flip" id="clubpagelink">Bars/Clubs</a></li>
				<li><a href="restaurantlist.html" data-transition="flip" id="restaurantpagelink" class="ui-btn-active ui-state-persist">Nhà hàng</a></li>
				<li><a href="shoppinglist.html" data-transition="flip" id="shoppingpagelink">Mua sắm</a></li>
			</ul>
		</div><!-- /navbar -->
	</div><!-- /footer -->
	<script type="text/javascript">
		function downloadRestaurantList(){
			showLoading();
			wpJSON.request(
			   'pg.getRestaurantList',
			   {},
			   function (result) {
					restaurantList = result;
					$('ul#restaurantlist').empty();
					restaurantList.forEach(function(post){
						$('ul#restaurantlist').append(
							'<li>' +
								'<a href="restaurantdetail.html?post_id=' + post.id + '">' + 
									'<img src="' + post.thumbnail[0] + '"/>' +
									'<h2>' + post.name + '</h2>' +
									'<p>' + post.address + '</p>' +
								'</a>' +
							'</li>'
						);
					});
					$('ul#restaurantlist').listview('refresh');
					hideLoading();
			   },
			   function( code, error, data ) {
					console.log('error: ' + error);
			   }
			);
		}
		
		$('div#restaurantlistpage').on('pageshow',function(){
			$('#togglesearchbtn').click(function(){
				$('ul#searchsection').slideDown();
			});
			
			$('a#search-cancel').click(function(){
				$('ul#searchsection').slideUp();
			});
			
			$('a#search-submit').click(function(){
				var searchTerm = $('input#search-term').val().replace(/\s/g,'+');
				$(this).attr('href','search.html?type=restaurant&s=' + searchTerm);
			});
			
			if (restaurantList.length == 0){
				downloadRestaurantList();
			} else {
				$('ul#restaurantlist').empty();
				restaurantList.forEach(function(post){
					$('ul#restaurantlist').append(
						'<li>' +
							'<a href="restaurantdetail.html?post_id=' + post.id + '">' + 
								'<img src="' + post.thumbnail[0] + '"/>' +
								'<h2>' + post.name + '</h2>' +
								'<p>' + post.address + '</p>' +
							'</a>' +
						'</li>'
					);
				});
				$('ul#restaurantlist').listview('refresh');
			}
		});
		
		$('a#restaurantlistrefreshbtn').click(function(){
			restaurantList = [];
			downloadRestaurantList();
		});
	</script>
</div><!-- /page#restaurantlist -->